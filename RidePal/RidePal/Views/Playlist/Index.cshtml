@using RidePal.WEB.Models;

@model PlaylistViewModel
@{
    var startCoordinates = this.Model.Trip.StartCoordinates.Split(',').ToArray();
    var destCoordinates = this.Model.Trip.DestinationCoordinates.Split(',').ToArray();
}

<head>

</head>
<body>
    <div class="ms_main_wrapper">
        <div class="ms_content_wrapper padder_top80">
            <div id='myMap' style='width: 100%; height: 350px;'></div>
            
            <p>
                @Model.Audience.Name
            </p>
            <p>
                @Model.Author.Email
            </p>
            <p>
                @String.Format("{0:0.##}", Model.AvgRank);
            </p>
            <p>
                @TimeSpan.FromSeconds(Model.Duration).ToString(@"hh\:mm\:ss")
            </p>
            @foreach (var item in @Model.Genres)
            {
                <p>
                    @item.Name
                </p>
            }
            <table>
                <tr>
                    <th>Title</th>
                    <th>Album</th>
                    <th>Rank</th>
                    <th>Artist</th>
                    <th>Duration</th>
                </tr>

                @foreach (var track in Model.Tracks)
                {
                    <tr>
                        <td> @track.Track.Title</td>
                        <td> @track.Track.Album.Name</td>
                        <td> @track.Track.Rank</td>
                        <td> @track.Track.Genre.Name</td>
                        <td> @track.Track.Artist.Name</td>
                        <td> @TimeSpan.FromSeconds(track.Track.Duration).ToString(@"mm\:ss") </td>
                    </tr>

                }
            </table>
            <a asp-action="Delete" asp-route-title=@Model.Name class="button-1">Delete</a>
            <a asp-action="EditPlaylist" asp-route-title=@Model.Name class="button-1">Edit</a>
        </div>
    </div>

    <script type='text/javascript'>
        function loadMapScenario() {
            var map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
                /* No need to set credentials if already passed in URL */

            });

            Microsoft.Maps.loadModule('Microsoft.Maps.Directions', function () {

                var directionsManager = new Microsoft.Maps.Directions.DirectionsManager(map);
                // Set Route Mode to driving
                directionsManager.setRequestOptions({ routeMode: Microsoft.Maps.Directions.RouteMode.driving });
                var waypoint1 = new Microsoft.Maps.Directions.Waypoint({ location: new Microsoft.Maps.Location(@startCoordinates[0], @startCoordinates[1]) });
                var waypoint2 = new Microsoft.Maps.Directions.Waypoint({ location: new Microsoft.Maps.Location(@destCoordinates[0], @destCoordinates[1]) });
                directionsManager.addWaypoint(waypoint1);
                directionsManager.addWaypoint(waypoint2);
                // Set the element in which the itinerary will be rendered
                directionsManager.setRenderOptions({ itineraryContainer: document.getElementById('printoutPanel') });
                directionsManager.calculateDirections();
            });
        }

    </script>
    <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?key=Ap4BY1B20Ldbim2QZCCJK3EAW0jdSisoIOvt3kJjv8dBjM_3pzfu9442oM8AsrxJ&callback=loadMapScenario' async defer></script>
</body>