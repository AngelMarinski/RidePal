@model IEnumerable<RidePal.Services.DTOModels.UserDTO>

<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
<link href="~/css//all-users.css" rel="stylesheet">
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="main-box clearfix">
                <div class="table-responsive">
                    <table class="table user-list">
                        <thead>
                            <tr>
                                <th><span>User</span></th>
                                <th><span>Email</span></th>
                                <th><span>Status</span></th>
                                <th>&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in this.Model)
                            {
                                <tr>
                                    <td>
                                        <img src="~/Images/@user.ImagePath" alt="profile image">
                                        <a asp-controller="User" asp-action="Index" asp-route-email="@user.Email" class="user-link">@user.Username</a>
                                        <span class="user-subhead">@user.RoleId.ToString()</span>
                                    </td>
                                    <td>
                                        <a asp-controller="User" asp-action="Index" asp-route-email="@user.Email">@user.Email</a>
                                    </td>
                                    @if (this.User.HasClaim(x => x.Value == "Admin"))
                                    {
                                        <td class="text-center">
                                            @if (user.IsBlocked)
                                            {
                                                <span class="label label-default">Blocked</span>
                                            }
                                            else
                                            {
                                                <span class="label label-default">Unblocked</span>
                                            }
                                        </td>
                                    }

                                    <td style="width: 20%;">
                                        @if (!user.Friends.Any(x => x.Email == this.User.Identity.Name) && !user.ReceivedFriendRequests.Any(x => x.Sender.Email == this.User.Identity.Name) && !user.SentFriendRequests.Any(x => x.Recipient.Email == this.User.Identity.Name))
                                        {
                                            <a asp-action="SendFriendRequest" asp-route-senderEmail="@User.Identity.Name" asp-route-recipientEmail="@user.Email" asp-route-currentView="allUsers" class="button-1">Add Friend</a>
                                        }
                                        else if (user.Friends.Any(x => x.Email == this.User.Identity.Name))
                                        {
                                            <a asp-action="RemoveFriend" asp-route-email="@User.Identity.Name" asp-route-friendEmail="@user.Email" asp-route-currentView="allUsers" class="button-1">Unfriend</a>
                                        }
                                        else if (user.ReceivedFriendRequests.Any(x => x.Sender.Email == this.User.Identity.Name))
                                        {
                                            <a asp-action="DeclineFriendRequest" asp-route-senderEmail="@User.Identity.Name" asp-route-recipientEmail="@user.Email" asp-route-currentView="allUsers" class="button-1">Cancel Request</a>
                                        }
                                        else
                                        {
                                            <a asp-action="AcceptFriendRequest" asp-route-recipientEmail="@User.Identity.Name" asp-route-senderEmail="@user.Email" asp-route-currentView="allUsers" class="button-1">Confirm Request</a>
                                            <a asp-action="DeclineFriendRequest" asp-route-recipientEmail="@User.Identity.Name" asp-route-senderEmail="@user.Email" asp-route-currentView="allUsers" class="button-1">Remove Request</a>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    //function myFunction() {
        
    //    var element = document.getElementById("friend-btn");
    //    if(element.textContent==="Send"){
    //        element.textContent = "Remove";
    //        element.setAttribute("asp-action","RemoveFriendRequest");
    //    }else{

    //        element.textContent = "Send";
    //        element.setAttribute("asp-action", "SendFriendRequest");
    //    }
    //}
    //$("friend-btn").click(function () {
    //    $.post("demo_test_post.asp",
    //        {
    //            name: "Donald Duck",
    //            city: "Duckburg"
    //        },
    //        function (data, status) {
    //            alert("Data: " + data + "\nStatus: " + status);
    //        });
    //});

    //document.getElementById("friend-btn").addEventListener("click", myFunction);

    //function myFunction() {
    //    var element = document.getElementById("friend-btn");
    //    if (element.innerHTML==="Send") {
    //        element.innerHTML = "Remove";
    //    }else{
    //        element.innerHTML = "Send";
    //    }
    //}

</script>
